:css
  #img_selector_parent{
    display:none;
  }
  #img_selector_parent table{ 
    width: 104px;
    height: 104px;
    border:1px solid #ddd;
    border-spacing:0;
  }
  table#img_selector_parent td{ 
    text-align:center;
  }
  #img_selector { 
    
  }
  #img_selector > img {
    max-width:100px;
    max-height:100px;
    margin-left:auto;
    margin-right:auto;
    display:none;
  }
    
  #offscreen_div {position:absolute; left:-5000px; width:1px; overflow:hidden; }

:javascript
  $(function(){
  
    var image_elems = [];
    
    var current_image_indx = null;
    var total_images = 0;
    
    function select_image(indx){
      current_image_indx = indx;
      $("#img_selector img").css({ "display" : "none"});
      var current_img = $("#img_selector img:nth-child(" + (current_image_indx + 1) + ")");
      current_img.css({"display" : "block"});
      $("#status_form #image_url").val(current_img.attr("src"));
    }
    
    function toggle_navigation(){
      if (current_image_indx + 1 < total_images){
        $("#next_image").removeAttr('disabled');
      }
      else
      {
        $("#next_image").attr('disabled', 'disabled');
      }
      if (current_image_indx > 0){
        $("#prev_image").removeAttr('disabled');
      }
      else
      {
        $("#prev_image").attr('disabled', 'disabled');
      }
    }
    
    function clear_images(){
      $("#img_selector").html("");
    }
    
    function reset_all(){
      current_image_indx = null;
      total_images = 0;
      
      $("#img_selector_parent").css({ "display" : "block" });
      $("#img_selector").html('#{ image_tag 'loading.gif', :style => 'display:block;' }');
      
      toggle_navigation();
    }
    
    function append_image(image_elem){
      if (current_image_indx == null){
        $("#img_selector").html("");
      }
      image_elem.appendTo("#img_selector");
      total_images++;
      if ( current_image_indx == null ){
        select_image(0);
      }

      toggle_navigation();
    }
  
    function load_images(images){
      $("#img_selector").html('#{ image_tag 'loading.gif', :style => 'display:block;' }');
      for (var image in images){
        var new_img = $("<img src='"+ images[image] +"' />");
        new_img.appendTo("#offscreen_div");
        new_img.load(function(){
          if ($(this).width() > 50 && $(this).height() > 50){
            append_image($(this))
          }
        });
      }
    }
    
    $("#prev_image").click(function(){
      select_image((current_image_indx - 1 + total_images) % total_images);
      toggle_navigation();
    });
    
    $("#next_image").click(function(){
      select_image((current_image_indx + 1) % total_images);
      toggle_navigation();
    });
  
    // TODO : Try better RE
    var url_re = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
    
    var last_processed_url = null;
    
    function process_url(){
      var matches = $("#status").val().match(url_re);
      
      if (!matches) {
        return;
      }

      var url = matches[0];
      
      if (last_processed_url && last_processed_url == url){
        return;
      }
      
      last_processed_url = url;
      
      reset_all();
      
      $.post(
          '/social/scrape',  
          {url: url},  
          function(json) {
            //alert("So this is resp " + JSON.stringify(json) );
            load_images(json.images);
            //$("#page_title").html(json.title);
            //$("#page_description").html(json.description);
          },
          "json"
      );
    }
    
    $('#status').keyup(function(event){
      if (event.which == 32){
        process_url();
      }
    });
    
    $('#status').change(function(){
      process_url();
    });
    
    $("#get_images").click(function(){
      process_url();
      return false;
    });

  });

#offscreen_div

#img_selector_parent
  %table
    %tr
      %td#img_selector{ :align => "center" }
        -# = image_tag "loading.gif", :style => "display:block;"

  -#title_and_description
    -#page_title
    -#page_description

  %button#prev_image{ :disabled => 'disabled' } &lt;
  %button#next_image{ :disabled => 'disabled' } &gt;

%span#selector_status

=form_tag "/social/create", :remote => true, :id => "status_form" do
  =text_field_tag "status", "http://www.nytimes.com/"
  =hidden_field_tag "image_url"
  %button{:id => "get_images"} Get Images
  =submit_tag "Send"
