= stylesheet_link_tag "anythingslider.css"

:css
  #img_selector { width:100px; height:100px;  border:1px solid; }
  #img_selector > img { width:100px; height:100px; }


/ Older IE stylesheet, to reposition navigation arrows, added AFTER the theme stylesheet above
/[if lte IE 7]
  = stylesheet_link_tag "anythingslider-ie.css"

%h1 Social#new
%p Find me in app/views/social/new.html.haml

:javascript
  $(function(){
  
    var image_elems = [];
    
    var current_image_indx;
    var total_images = 0;
    
    function select_image(indx){
      current_image_indx = indx;
      $("#img_selector img").css({ "display" : "none"});
      var current_img = $("#img_selector img:nth-child(" + (current_image_indx + 3) + ")");
      current_img.css({"display" : "block"});
      $("#status_form #image_url").val(current_img.attr("src"));
    }
  
    function load_images(images){
      $("#img_selector").html("<span></span>");
      for (var image in images){
        var new_img = $("<img src='"+ images[image] +"' />");
        new_img.appendTo("#img_selector");
      }
      total_images = images.length;
      select_image(0);
    }
    
    $("#prev_image").click(function(){
      select_image(current_image_indx - 1);
    });
    
    $("#next_image").click(function(){
      select_image(current_image_indx + 1);
    });
  
    // TODO : Try better RE
    var url_re = /((http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?)/ix;
    
    function process_url(){
      var matches = $("#status").val().match(url_re);
      
      if (!matches) {
        return;
      }

      var url = matches[0];
      
      $.post(
          '/social/scrape',  
          {url: url},  
          function(json) {  
            load_images(json);
          },
          "json"
      );
    }
    
    $('#status').keyup(function(event){
      if (event.which == 32){
        process_url();
      }
    });

  });

#img_selector

%button#prev_image &lt;
%button#next_image &gt;

%span#selector_status

=form_tag "/social/create", :remote => true, :id => "status_form" do
  =text_field_tag "status", ""
  =hidden_field_tag "image_url"
  =submit_tag "Send"
